# 自适应分组测试策略说明

## 🎯 策略概述

自适应分组测试策略是一种智能的测试方法，通过逐步递减的分组比例（30% → 20% → 10%）来优化测试效率，同时确保每个分组中的点位关系尽可能未知。

## 🔄 核心策略

### 1. 逐步递减分组比例
- **第一阶段（30%）**：使用30%的点位进行分组测试
- **第二阶段（20%）**：使用20%的点位进行分组测试  
- **第三阶段（10%）**：使用10%的点位进行分组测试

### 2. 关系未知性优化
- 优先选择关系未知的点位组合
- 每组最多10%的点位关系已知
- 动态调整分组以保持未知关系比例

### 3. 智能分组选择
- 最大化未知关系数量
- 平衡电源点位分布
- 避免冗余测试

### 4. 动态策略调整
- 实时监控关系矩阵状态
- 自动切换测试阶段
- 优化测试效率

## 📊 配置参数

### 基础配置
```python
BASE_CONFIG = {
    'total_points': 100,        # 总点位数量
    'concurrency': 4,           # 并发数
    'relay_switch_time': 50,    # 继电器切换时间(ms)
    'test_duration': 100,       # 测试持续时间(ms)
    'max_test_time': 300,       # 最大测试时间(ms)
}
```

### 自适应分组配置
```python
ADAPTIVE_GROUPING_CONFIG = {
    'group_ratios': [0.30, 0.20, 0.10],  # 分组比例
    'min_group_size': 5,                  # 最小分组大小
    'max_group_size': 50,                 # 最大分组大小
    'max_known_relations_per_group': 0.1, # 每组最多10%已知关系
    'prefer_unknown_relations': True,     # 优先选择未知关系
    'selection_strategy': 'max_unknown_relations',  # 选择策略
    'balance_power_sources': True,        # 平衡电源点位分布
}
```

### 测试执行配置
```python
TEST_EXECUTION_CONFIG = {
    'max_total_tests': 1000,              # 最大总测试次数
    'max_tests_per_phase': 200,           # 每阶段最大测试次数
    'phase_switch_criteria': {
        'min_unknown_relations': 0.2,     # 未知关系少于20%时切换
        'max_known_ratio': 0.8,           # 已知关系超过80%时切换
        'min_tests_per_phase': 50,        # 每阶段最少测试次数
    }
}
```

## 🚀 使用方法

### 1. 快速启动
```bash
# 使用默认配置（平衡模式）
python run_adaptive_grouping.py

# 使用保守配置
python run_adaptive_grouping.py --preset conservative

# 使用激进配置
python run_adaptive_grouping.py --preset aggressive

# 自定义最大测试次数
python run_adaptive_grouping.py --max-tests 500

# 显示配置信息
python run_adaptive_grouping.py --show-config
```

### 2. 配置预设
- **conservative（保守）**：更小的分组比例，更严格的未知性要求
- **balanced（平衡）**：标准配置，平衡效率和未知性
- **aggressive（激进）**：更大的分组比例，允许更多已知关系

### 3. 命令行参数
- `--preset, -p`：选择预设配置
- `--url, -u`：指定Flask服务器地址
- `--max-tests, -m`：设置最大测试次数
- `--show-config, -s`：显示配置信息

## 🔍 工作原理

### 1. 初始化阶段
- 创建100x100的关系矩阵
- 初始化已知关系（对角线）和未知关系集合
- 设置测试阶段和分组比例

### 2. 分组创建
- 计算当前未知关系比例
- 随机选择点位组合
- 评估组合的关系未知性得分
- 选择最优的电源点位

### 3. 测试执行
- 运行单次测试
- 更新关系矩阵
- 记录测试结果和性能统计
- 检查是否需要切换阶段

### 4. 阶段切换
- 监控未知关系比例
- 当满足切换条件时自动切换
- 调整分组大小和策略

### 5. 结果分析
- 统计各阶段测试次数
- 分析关系矩阵状态
- 评估测试效率
- 保存详细结果

## 📈 性能优化

### 1. 关系未知性优化
- 优先选择关系未知的点位组合
- 动态调整分组策略
- 实时监控关系矩阵状态

### 2. 电源点位平衡
- 避免某些点位过度使用
- 平衡测试负载分布
- 提高整体测试效率

### 3. 批量优化
- 启用批量测试优化
- 继电器操作优化
- 减少不必要的切换

### 4. 动态调整
- 根据测试进度调整策略
- 自动优化分组大小
- 智能阶段切换

## 📋 输出结果

### 1. 实时状态
- 当前测试阶段和分组大小
- 已知/未知关系数量
- 继电器操作统计
- 测试进度信息

### 2. 阶段统计
- 各阶段测试次数
- 阶段耗时统计
- 效率分析结果

### 3. 最终报告
- 总测试次数和时间
- 关系矩阵完整度
- 性能统计摘要
- 电源点位使用分布

### 4. 结果文件
- 保存为JSON格式
- 包含完整测试历史
- 详细的性能数据
- 可重用的配置信息

## 🎯 策略优势

### 1. 效率提升
- 逐步递减的分组比例减少冗余测试
- 智能分组选择最大化信息获取
- 动态策略调整优化测试流程

### 2. 质量保证
- 确保各分组中关系尽可能未知
- 平衡电源点位使用分布
- 避免测试偏差和遗漏

### 3. 灵活性
- 多种预设配置适应不同需求
- 命令行参数支持自定义设置
- 实时监控和动态调整

### 4. 可扩展性
- 模块化设计便于扩展
- 配置驱动的策略管理
- 支持不同规模和复杂度

## 🔧 故障排除

### 1. 常见问题
- **服务器连接失败**：检查Flask服务器是否运行
- **测试执行失败**：检查API接口和参数
- **性能问题**：调整配置参数和分组策略

### 2. 调试方法
- 使用`--show-config`查看配置
- 检查控制台输出和错误信息
- 分析保存的结果文件

### 3. 优化建议
- 根据实际情况调整分组比例
- 优化阶段切换条件
- 平衡测试效率和未知性要求

## 📚 相关文件

- `adaptive_grouping_config.py`：配置文件
- `adaptive_grouping_test.py`：核心测试逻辑
- `run_adaptive_grouping.py`：快速启动脚本
- `自适应分组测试策略说明.md`：本文档

## 🚀 快速开始

1. 确保Flask服务器正在运行
2. 选择适合的预设配置
3. 运行测试脚本
4. 监控测试进度和结果
5. 分析测试效果和优化策略

---

*这个策略通过智能的分组选择和动态调整，在保证测试质量的同时显著提升了测试效率。*

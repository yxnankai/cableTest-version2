# 线缆测试系统使用说明

## 系统概述

本系统是基于README实验说明开发的线缆导通测试模拟程序，主要用于模拟飞机上线缆的自学习算法测试。系统能够：

- 模拟10000+个测试点位
- 随机生成一对一、一对多连接关系
- 模拟继电器控制（3ms开关时间）
- 检测线缆导通情况
- 生成随机测试数据
- 导出测试结果

## 文件结构

- `cable_test_system.py` - 核心测试系统
- `test_interface.py` - 简化测试接口
- `使用说明.md` - 本说明文档

## 快速开始

### 1. 运行演示程序

```bash
python test_interface.py
```

这将运行一个完整的演示，包括：
- 系统初始化
- 快速测试
- 批量测试
- 结果导出

### 2. 使用简化接口

```python
from test_interface import SimpleTestInterface

# 创建测试接口
interface = SimpleTestInterface(total_points=1000)

# 运行快速测试
result = interface.quick_test()

# 运行批量测试
results = interface.batch_test(5)

# 导出结果
interface.export_results()
```

### 3. 使用核心系统

```python
from cable_test_system import CableTestSystem

# 创建测试系统
system = CableTestSystem(total_points=10000)

# 运行单次测试
result = system.run_single_test(
    power_source=0,           # 电源输入点位
    test_points=[1, 2, 3, 4] # 要测试的点位
)

# 生成随机测试配置
configs = system.generate_random_test_configs(test_count=10)

# 运行批量测试
results = system.run_batch_tests(configs)
```

## 主要功能

### 测试点位管理

- **总点位数量**: 可配置，默认10000个
- **继电器状态**: 每个点位都有独立的继电器控制
- **电压电流**: 模拟电压电流检测
- **连接状态**: 跟踪点位的连接情况

### 连接关系模拟

- **一对一连接**: 约30%的点位
- **一对多连接**: 约20%的点位（2-5个目标点）
- **随机分布**: 每次运行都会生成不同的连接关系

### 继电器控制

- **开关时间**: 3ms（可配置）
- **状态管理**: 开/关两种状态
- **操作计数**: 统计继电器操作次数

### 导通检测

- **电源输入**: 指定某个点位作为电源
- **激活点位**: 同时开启多个点位进行测试
- **连接检测**: 自动检测导通关系
- **结果记录**: 保存每次测试的详细信息

## 测试流程

1. **系统初始化**
   - 创建指定数量的测试点位
   - 随机生成连接关系
   - 所有继电器初始状态为关闭

2. **测试执行**
   - 指定电源输入点位
   - 激活要测试的点位（开启继电器）
   - 检测导通情况
   - 记录测试结果

3. **结果分析**
   - 统计检测到的连接关系
   - 计算测试时间和继电器操作次数
   - 保存测试历史

## 输出格式

### 测试结果结构

```python
TestResult(
    test_id="test_1234567890_1234",    # 测试ID
    timestamp=1234567890.123,          # 时间戳
    power_source=0,                    # 电源点位
    active_points=[1, 2, 3, 4],       # 激活的点位
    detected_connections=[...],        # 检测到的连接
    test_duration=0.123,              # 测试耗时
    relay_operations=5,                # 继电器操作次数
    total_points=10000                 # 总点位数量
)
```

### 连接关系结构

```python
Connection(
    source_point=0,                    # 源点位
    target_points=[1, 2, 3],          # 目标点位列表
    connection_type="one_to_many"      # 连接类型
)
```

### 导出文件格式

测试结果以JSON格式导出，包含：
- 系统信息
- 所有连接关系
- 测试历史记录
- 统计信息

## 配置参数

### 系统参数

- `total_points`: 总测试点位数量
- `relay_switch_time`: 继电器开关时间（秒）

### 测试参数

- `test_count`: 批量测试次数
- `max_points_per_test`: 每次测试的最大点位数量
- `power_source`: 电源输入点位
- `test_points`: 要测试的点位列表

## 使用示例

### 示例1: 自定义测试

```python
from test_interface import SimpleTestInterface

interface = SimpleTestInterface(total_points=5000)

# 指定电源和测试点位
result = interface.quick_test(
    power_source=100,
    test_points=[200, 300, 400, 500]
)
```

### 示例2: 大规模测试

```python
from cable_test_system import CableTestSystem

system = CableTestSystem(total_points=20000)

# 生成100次随机测试
configs = system.generate_random_test_configs(test_count=100, max_points_per_test=200)

# 运行测试
results = system.run_batch_tests(configs)

# 导出结果
system.export_test_results("large_scale_test.json")
```

### 示例3: 结果分析

```python
# 获取系统状态
status = system.get_system_status()
print(f"总测试次数: {status['total_tests']}")
print(f"总继电器操作: {status['total_relay_operations']}")

# 分析测试历史
for result in system.test_history[-5:]:  # 最近5次测试
    print(f"测试 {result.test_id}: 检测到 {len(result.detected_connections)} 个连接")
```

## 注意事项

1. **性能考虑**: 大量点位会增加内存使用和测试时间
2. **随机性**: 每次运行都会生成不同的连接关系
3. **时间模拟**: 继电器开关时间会影响测试总时间
4. **数据导出**: 大量测试结果可能产生较大的导出文件

## 故障排除

### 常见问题

1. **内存不足**: 减少总点位数量
2. **测试时间过长**: 减少每次测试的点位数量
3. **结果文件过大**: 定期清理测试历史

### 调试模式

启用详细日志：
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

## 扩展功能

系统设计为可扩展的，可以轻松添加：
- 新的连接类型
- 更复杂的导通检测算法
- 统计分析功能
- 可视化界面
- 数据库存储

## 技术支持

如有问题或建议，请查看代码注释或联系开发团队。
